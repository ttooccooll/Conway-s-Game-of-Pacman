<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Conway's Game of Pacman</title>
    <link rel="icon" href="pac.png" type="image/jpeg" />
    <script
      src="https://unpkg.com/webln@0.3.2/dist/webln.min.js"
      integrity="sha384-MpjpvOQqXz9nCoLUS/sR0bhLwGYuNPMOBN50jsqhnqAzDq0GiOI0u6oC5fHitzI2"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/bech32@2.0.0/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <script src="https://unpkg.com/nostr-tools/lib/nostr.bundle.js"></script>
    <script src="https://unpkg.com/@scure/base@1.1.1"></script>
    <script src="script.js" defer></script>
    <link rel="stylesheet" id="stylesheet" href="style.css" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
    <meta name="description" content="Conway's Game of Pacman - Play pacman, but the walls are evolving as Jon Conway's Game of Life.">
    <link rel="canonical" href="https://turtlewordgame.xyz/" />
    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "VideoGame",
            "name": "Turtle",
            "description": "A daily word puzzle game inspired by Wordle with optional Bitcoin Lightning payments.",
            "genre": ["Puzzle", "Word Game"],
            "applicationCategory": "Game",
            "operatingSystem": "Web",
            "url": "https://turtlewordgame.xyz/",
            "inLanguage": ["en"],
            "offers": {
                "@type": "Offer",
                "price": "0",
                "priceCurrency": "USD"
            }
        }
    </script>
  </head>

  <body>
    <header role="banner">
      <button class="icon-button" id="username-btn">sign-in</button>
      <h1>
        Conway's Game of Pacman
        <span class="visually-hidden">
            - Life Arena Simulation
        </span>
      </h1>
      <button class="icon-button" id="help-btn">?</button>
      <button class="icon-button" id="stats-btn">stats</button>
    </header>

    <main role="main">
      <div id="livestats">
        <div id="score-display">Total: <strong> 0 </strong></div>
        <div id="gen-display">Generations: <strong> 0 </strong></div>
        <div id="bit-display">Bitcoin: <strong> 0 </strong></div>
      </div>
      <canvas id="life-canvas" width="560" height="560" tabindex="0" aria-label="Life Arena grid"></canvas>
    </main>

    <div id="message-container"></div>

    <div id="touch-controls">
      <div id="touchlabel"></div>
        <button id="up-btn" class="arcade"></button>
        <button id="left-btn" class="green"></button>
        <button id="right-btn" class="orange"></button>
        <button id="down-btn" class="purple"></button>
    </div>

    <div id="controls">
      <button id="start-btn" class="arcade"></button>
          <span class="arcade-label">Start</span>
      <button id="pause-btn" class="darkorange"></button>
          <span class="arcade-label">Pause</span>
      <button id="reset-btn" class="green"></button>
          <span class="arcade-label">Reset</span>
    </div>

    <div class="modal" id="help-modal">
      <div class="modal-content">
        <h2>How to Play</h2>
        <p>Build your world by clicking cells on the grid. Then start the simulation to watch life evolve.</p>
        <p>Rules (Conway's Game of Life):</p>
        <ul>
          <li>Any live cell with 2 or 3 live neighbors survives.</li>
          <li>Any dead cell with exactly 3 live neighbors becomes alive.</li>
          <li>All other cells die or remain dead.</li>
        </ul>
        <p>One free simulation per day. Additional simulations require Bitcoin Lightning payment.</p>
        <button onclick="closeModal('help-modal')">Got it!</button>
      </div>
    </div>

    <div class="modal" id="stats-modal">
      <div class="modal-content">
        <h2></h2>
        <div id="nostr-profile" style="margin-top:12px; display:none;">
          <img id="nostr-avatar" style="width:78px; height:78px; border-radius:50%;" />
          <div id="nostr-username"></div>
        </div>
        <div class="stats-grid">
          <div class="stat-item">
            <span class="stat-label">Games Played -</span>
            <span class="stat-number" id="played">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Best Score -</span>
            <span class="stat-number" id="best-score">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Last Score -</span>
            <span class="stat-number" id="last-score">0</span>
          </div>
        </div>
        <button id="tip-btn" style="display: none">Buy me coffee!</button>
        <button onclick="closeModal('stats-modal')">Close</button>
        <div id="leaderboard" class="leaderboard"></div>
      </div>
    </div>

    <div class="modal" id="game-over-modal">
      <div class="modal-content">
        <h2 id="game-over-title"></h2>
        <p id="game-over-message"></p>
        <div id="game-over-answer" style="margin: 20px 0"></div>
        <button onclick="resetGame()">Close</button>
      </div>
    </div>

    <div id="payment-qr-modal" class="modal">
      <div class="modal-content">
        <h2>Pay with Bitcoin</h2>
        <p id="qr-instruction">
          Scan this QR code with your Lightning wallet to play again. Otherwise, please come back for your free daily game tomorrow!
        </p>
        <canvas id="qr-code"></canvas>
        <input
          type="text"
          id="invoice-text"
          style="position: absolute; left: -9999px"
          readonly
        />
        <button id="copy-invoice-btn">Copy Invoice</button>
        <button id="close-qr-btn">Close (game will not begin)</button>
        <p id="qr-status">Waiting for payment...</p>
      </div>
    </div>

    <div id="username-modal" class="modal">
      <div class="modal-content">
        <button id="nostr-login-btn">Login with Browser Extension</button>
        <div>
          <input id="npub-input" placeholder="npub1..." />
        </div>
        <div>
          <button id="npub-submit">Submit</button>
          <button class="close-btn" onclick="closeModal('username-modal')">✕</button>
        </div>
      </div>
    </div>

    <div id="lnurl-modal" class="modal">
      <div class="modal-content">
        <h3>Scan to Zap ⚡</h3>
        <canvas id="lnurl-qr"></canvas>
        <p>Open with any Lightning wallet</p>
        <button onclick="closeModal('lnurl-modal')">Close</button>
      </div>
    </div>

  </body>
</html>
